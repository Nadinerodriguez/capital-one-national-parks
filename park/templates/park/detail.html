{% extends 'park/base.html' %}

{% block content %}

<style>
  body {
    position: relative;
  }

  .sticky-offset {
    top: 30px;
  }

  #mapid {
    height: 500px;
  }

</style>

<script>
  $(document).ready(function() {
    // $('#main-nav-bar').hide();
    $('body').attr('data-spy', 'scroll');
    $('body').attr('data-target', '#list-example');
    $('body').scrollspy({ target: '#list-example' });
  });
</script>

<div class="container mt-3 mb-5">
  <div class="accordion" id="map-view-accordion">
    <div class="card rounded border shadow-sm">
      <div id="map-view-card">
        <h2 class="mb-0">
          <a id="map-view-button" class="btn btn-secondary btn-block" data-toggle="collapse" href="#collapseOne" role="button" aria-expanded="true" aria-controls="collapseOne">
            <label style="font-size: 24px; font-weight: bold;">Hide/Show Map View</label>
          </a>
        </h2>
      </div>

      <div id="collapseOne" class="collapse show" aria-labelledby="map-view-card" data-parent="#map-view-accordion">
        <div class="card-body">
          <div id="mapid">
            <!-- This holds a map view from JS script -->
            <label id="no-map" hidden>No current map coordinates available for this location.</label>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  /*
  Note: This script needs to be placed after #mapid
  From leafletjs
  */

  var lat = "{{ lat }}";
  var long = "{{ long }}";

  console.log(lat);
  console.log(long);

  // create map
  if (lat != "" && long != "") {
    console.log("Creating a map!");
    var mymap = L.map('mapid').setView([lat, long], 13);

    // render map layer
    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: '{{ access_token }}'
    }).addTo(mymap);

    // add marker
    var marker = L.marker([lat, long]).addTo(mymap);
    marker.bindPopup("<strong>{{ full_name }}</strong>").openPopup();

  } else {
    var noMap = document.getElementById('no-map');
    noMap.hidden = false;
    $('#map-view-button').attr('aria-expanded', 'false');
    $('#collapseOne').removeClass('show');
  }
</script>

<h2 class="text-center"> {{ overview.0.fullName }} </h2>
<!-- Holds our scroll spy container -->
<div class="container pt-5 mb-3 border-top border-bottom">
  <div class="row">

    <!-- Holds our categories -->
    <div class="col-3">
      <div id="list-example" class="list-group sticky-top sticky-offset">
        <a class="list-group-item list-group-item-action list-group-item-success" href="#list-item-1">Overview</a>
        <a class="list-group-item list-group-item-action list-group-item-success" href="#list-item-2">Alerts</a>
        <a class="list-group-item list-group-item-action list-group-item-success" href="#list-item-3">Articles, News, Events</a>
        <a class="list-group-item list-group-item-action list-group-item-success" href="#list-item-4">Places, Visitor Centers, Campgrounds</a>
        <a class="list-group-item list-group-item-action list-group-item-success" href="#list-item-5">Educational Information</a>

      </div>
    </div>

    <div class="col-9">
      <div data-spy="scroll" data-target="#list-example" data-offset="0" class="scrollspy-example">
        <h4 id="list-item-1" class="border-bottom">Overview</h4>
        <div>Description: {{ overview.0.description }} </div>
        <br/>
        <div>DirectionsInfo {{ overview.0.directionsInfo }} </div>
        <br/>
        <div>Entrance Fees {{ overview.0.entranceFees }} </div>
        <br/>
        <div>Entrance Passes {{ overview.0.entrancePasses }} </div>
        <br/>
        <div>Operating Hours{{ overview.0.operatingHours }} </div>
        <br/>
        <div>Exceptions {{ overview.0.exceptions }} </div>
        <br/>

        <h4 id="list-item-2" class="border-bottom">Alerts</h4>
        {% if alerts_total == "0" %}
        <div>No current alerts for this location</div>
        {% else %}
        {% for alert in alerts %}
        <div>
          <div> {{ alert.category }} </div>
          <div> {{ alert.title }} </div>
          <div> {{ alert.description }} </div>
          <div> {{ alert.url }} </div>
        </div>
        {% endfor %}
        {% endif %}
        <br/>

        <h4 id="list-item-3" class="border-bottom">Articles, News, Events</h4>
        <!-- Populate articles -->
        {% if articles_total == "0" %}
        <div>No current articles for this location</div>
        {% else %}
        <div class="container">
          <div class="row">
            {% for article in articles %}


            {% if forloop.counter0|divisibleby:"2" == True %}
            <div class="col-12 pb-4">
              <div class="card-deck" id="card-deck__{{forloop.counter0}}">
                {% endif %}

                <div class="card">

                  {% if article.listingimage.url == "" %}
                  <img class="card-img-top center-cropped bg-dark" src=http://www.sclance.com/pngs/image-placeholder-png/image_placeholder_png_698412.png />
                  {% else %}
                  <img class="card-img-top center-cropped bg-dark" src="{{ article.listingimage.url }}" alt="article image" />
                  {% endif %}

                  <div class="card-body">
                    <h5 class="card-title">{{ article.title }}</h5>
                    <p class="card-text">{{ article.listingdescription }}</p>
                  </div>
                  <div class="card-footer">
                    <a href="{{ article.url }}" class="btn btn-primary">Article link</a>
                  </div>
                </div>

                {% if forloop.counter0|divisibleby:"2" == False %}
              </div>
            </div>
            {% endif %}

            <!-- Edge case: Ensure we have enough closing divs and that the last article only takes up col-6 space -->
            {% if forloop.last and forloop.counter0|divisibleby:"2" == True %}
          </div>
        </div>

        <script>
          var lastArticleCardDeck = document.getElementById("card-deck__{{forloop.counter0}}");
          lastArticleCardDeck.classList.remove("card-deck");
          lastArticleCardDeck.parentElement.classList.replace("col-12", "col-6");
        </script>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    {% endif %}
    <br/>

    <!-- Populate news -->
    {% if news_total == "0" %}
    <div>No current news for this location</div>
    {% else %}
    {% for news_release in news_releases %}
    <div><strong>News release: </strong> {{ news_release.title }} </div>
    <div> {{ news_release.abstract }} </div>
    <div> {{ news_release.releasedate }} </div>
    <div> {{ news_release.url }} </div>
    <br />
    {% endfor %}
    {% endif %}
    <br/>

    <!-- Populate events -->
    {% if events_total == "0" %}
    <div>No current events for this location</div>
    {% else %}
    {% for event in events %}
    <div><strong>Event: </strong>{{ event.title }}</div>
    <div id="event-description__{{forloop.counter0}}">
      <!-- Api endpoint for events returns some html in a string
      We need to parse this string into HTML code using the safe filter -->
      {{ event.description|safe }}
    </div>
    <div>
      {% if not event.images.0.url %} <!-- If we have 0 images -->
      <img src="http://www.sclance.com/pngs/image-placeholder-png/image_placeholder_png_698412.png" class="img-fluid center-cropped" />
      {% else %}
      <img src="https://www.nps.gov{{ event.images.0.url }}" class="img-fluid center-cropped"/>
      {% endif %}
    </div>
    <div>
      {% for type in event.types %}
      <label>{{ type }} &nbsp;&nbsp;&nbsp;</label>
      {% endfor %}
    </div>
    {% endfor %}
    {% endif%}
    <br/>

    <h4 id="list-item-4" class="border-bottom">Places, Visitor Centers, Campgrounds</h4>
    <!-- Populate places -->
    {% if places_total == "0" %}
    <div>No current places for this location</div>
    {% else %}
    {% for place in places_total %}
    <div> {{ place.title }} </div>
    <div> {{ place.listingdescription }} </div>
    <div> {{ place.url }}</div>
    {% endfor %}
    {% endif %}
    <br/>

    <!-- Populate visitor centers -->
    {% if visitor_centers_total == "0" %}
    <div>No current visitor centers for this location</div>
    {% else %}
    {% for visitor_center in visitor_centers %}
    <div> {{ visitor_center.name }} </div>
    <div> {{ visitor_center.description }} </div>
    <div> {{ visitor_center.url }}</div>
    {% endfor %}
    {% endif %}
    <br/>

    <!-- Populate campgrounds -->
    {% if campgrounds_total == "0" %}
    <div>No current campgrounds for this location</div>
    {% else %}
    {% for campground in campgrounds %}
    <div> {{ campground.name }} </div>
    <div> {{ campground.description }} </div>
    {% endfor %}
    {% endif %}
    <br/>

    <h4 id="list-item-5" class="border-bottom">Educational Information</h4>
    <!-- Populate Educational Information -->
    {% if lesson_plans_total == "0" %}
    <div>No current lesson plans for this location</div>
    {% else %}
    {% for lesson_plan in lesson_plans %}
    <div> {{ lesson_plan.gradeLevel }} </div>
    <div> {{ lesson_plan.questionobjective }} </div>
    <div> {{ lesson_plan.subject }} </div>
    <div> {{ lesson_plan.title }} </div>
    {% endfor %}
    {% endif %}
    <br/>
  </div>
</div>
</div>
</div>


{% endblock %}
